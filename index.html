<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oak Hill Media Lab</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css" />
  <meta name="theme-color" content="#ffffff">
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>
  <div id="liveRegion" class="sr-only" aria-live="polite" aria-atomic="true"></div>
  <header class="app-header" role="banner">
    <img src="assets/logo.png" alt="Oak Hill Media Lab logo" class="logo" />
    <h1 id="appTitle">Oak Hill Media Lab</h1>
    <div class="header-actions">
      <button id="themeToggle" aria-pressed="false" title="Toggle high contrast">High Contrast</button>
      <button id="dysToggle" aria-pressed="false" title="Toggle dyslexia-friendly font">Dyslexia Font</button>
      <span id="userChip" class="chip" hidden></span>
      <button id="logoutBtn" class="secondary" hidden>Log out</button>
    </div>
  </header>

  <main id="app" role="main">
    <section id="view-login" class="view active" aria-labelledby="loginHeading">
      <h2 id="loginHeading">Sign in</h2>
      <p class="muted">Use your school account. (Demo mode stores accounts in your browser.)</p>
      <form id="loginForm" class="card" autocomplete="on">
        <label>Email <input id="loginEmail" autocomplete="email" type="email" required autocomplete="email" /></label>
        <label>Password <input id="loginPass" autocomplete="current-password" type="password" required autocomplete="current-password"/></label>
        <button type="submit">Sign in</button>
      </form>
      <details class="help"><summary>First time?</summary><p>Admin demo: <code>admin@oakhill.local</code> / <code>admin123</code></p></details>
    </section>

    <section id="view-student" class="view" aria-labelledby="studentHeading">
<!-- SEN-Friendly Student Dashboard -->
<section class="sen-hero">
  <h3>Start here</h3>
  <p class="sen-intro">Follow these simple steps. You can use text, pictures, or a short voice note. Ask for help anytime.</p>
  <div class="sen-toggles">
    <label class="switch"><input type="checkbox" id="guidedMode"><span>Guided Mode</span></label>
    <label class="switch"><input type="checkbox" id="largeText"><span>Large Text</span></label>
  </div>
</section>

<section class="sen-steps" aria-label="Your steps">
  <div class="step" data-step="plan">
    <div class="step-head"><span class="bubble">1</span><h4>Plan</h4><span class="emoji">💡</span></div>
    <p class="sen-help">Tell us your idea. You can write, draw, or record your voice.</p>
    <ul class="checklist" id="planList">
      <li><label><input type="checkbox" data-check="idea"> I explained my idea</label></li>
      <li><label><input type="checkbox" data-check="characters"> I listed people or roles</label></li>
      <li><label><input type="checkbox" data-check="story"> I wrote the beginning, middle, end</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="development">Open Planning</button>
      <button class="btn secondary" data-help="plan">Help</button>
    </div>
  </div>
  <div class="step" data-step="prepare">
    <div class="step-head"><span class="bubble">2</span><h4>Prepare</h4><span class="emoji">📋</span></div>
    <p class="sen-help">Make a simple plan for scenes and jobs.</p>
    <ul class="checklist" id="prepList">
      <li><label><input type="checkbox" data-check="storyboard"> I sketched or described 3 scenes</label></li>
      <li><label><input type="checkbox" data-check="roles"> We picked our team jobs</label></li>
      <li><label><input type="checkbox" data-check="props"> I listed props/equipment</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="preproduction">Open Preparation</button>
      <button class="btn secondary" data-help="prepare">Help</button>
    </div>
  </div>
  <div class="step" data-step="film">
    <div class="step-head"><span class="bubble">3</span><h4>Film</h4><span class="emoji">🎥</span></div>
    <p class="sen-help">Set up safely and record your scenes.</p>
    <ul class="checklist" id="filmList">
      <li><label><input type="checkbox" data-check="tripod"> Tripod and camera were safe</label></li>
      <li><label><input type="checkbox" data-check="sound"> We checked sound</label></li>
      <li><label><input type="checkbox" data-check="scenes"> We filmed our scenes</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="production">Open Filming</button>
      <button class="btn secondary" data-help="film">Help</button>
    </div>
  </div>
  <div class="step" data-step="edit">
    <div class="step-head"><span class="bubble">4</span><h4>Edit</h4><span class="emoji">🎬</span></div>
    <p class="sen-help">Put clips in order, add titles and sound.</p>
    <ul class="checklist" id="editList">
      <li><label><input type="checkbox" data-check="order"> Clips are in the right order</label></li>
      <li><label><input type="checkbox" data-check="titles"> I added titles or captions</label></li>
      <li><label><input type="checkbox" data-check="reflect"> I wrote or recorded my reflection</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="postproduction">Open Editing</button>
      <button class="btn secondary" data-help="edit">Help</button>
    </div>
  </div>
</section>

<section class="sen-progress">
  <div class="card">
    <h3>My progress</h3>
    <div class="progress-bar" aria-label="Overall progress">
      <div class="progress-fill" id="overallProgress" style="width:0%"></div>
    </div>
    <p class="muted" id="progressLabel">0% done • Keep going!</p>
  </div>
</section>

<!-- SEN-Friendly Student Dashboard -->
<section class="sen-hero">
  <h3>Start here</h3>
  <p class="sen-intro">Follow these simple steps. You can use text, pictures, or a short voice note. Ask for help anytime.</p>
  <div class="sen-toggles">
    <label class="switch"><input type="checkbox" id="guidedMode"><span>Guided Mode</span></label>
    <label class="switch"><input type="checkbox" id="largeText"><span>Large Text</span></label>
  </div>
</section>

<section class="sen-steps" aria-label="Your steps">
  <div class="step" data-step="plan">
    <div class="step-head"><span class="bubble">1</span><h4>Plan</h4><span class="emoji">💡</span></div>
    <p class="sen-help">Tell us your idea. You can write, draw, or record your voice.</p>
    <ul class="checklist" id="planList">
      <li><label><input type="checkbox" data-check="idea"> I explained my idea</label></li>
      <li><label><input type="checkbox" data-check="characters"> I listed people or roles</label></li>
      <li><label><input type="checkbox" data-check="story"> I wrote the beginning, middle, end</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="development">Open Planning</button>
      <button class="btn secondary" data-help="plan">Help</button>
    </div>
  </div>

  <div class="step" data-step="prepare">
    <div class="step-head"><span class="bubble">2</span><h4>Prepare</h4><span class="emoji">📋</span></div>
    <p class="sen-help">Make a simple plan for scenes and jobs.</p>
    <ul class="checklist" id="prepList">
      <li><label><input type="checkbox" data-check="storyboard"> I sketched or described 3 scenes</label></li>
      <li><label><input type="checkbox" data-check="roles"> We picked our team jobs</label></li>
      <li><label><input type="checkbox" data-check="props"> I listed props/equipment</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="preproduction">Open Preparation</button>
      <button class="btn secondary" data-help="prepare">Help</button>
    </div>
  </div>

  <div class="step" data-step="film">
    <div class="step-head"><span class="bubble">3</span><h4>Film</h4><span class="emoji">🎥</span></div>
    <p class="sen-help">Set up safely and record your scenes.</p>
    <ul class="checklist" id="filmList">
      <li><label><input type="checkbox" data-check="tripod"> Tripod and camera were safe</label></li>
      <li><label><input type="checkbox" data-check="sound"> We checked sound</label></li>
      <li><label><input type="checkbox" data-check="scenes"> We filmed our scenes</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="production">Open Filming</button>
      <button class="btn secondary" data-help="film">Help</button>
    </div>
  </div>

  <div class="step" data-step="edit">
    <div class="step-head"><span class="bubble">4</span><h4>Edit</h4><span class="emoji">🎬</span></div>
    <p class="sen-help">Put clips in order, add titles and sound.</p>
    <ul class="checklist" id="editList">
      <li><label><input type="checkbox" data-check="order"> Clips are in the right order</label></li>
      <li><label><input type="checkbox" data-check="titles"> I added titles or captions</label></li>
      <li><label><input type="checkbox" data-check="reflect"> I wrote or recorded my reflection</label></li>
    </ul>
    <div class="step-actions">
      <button class="btn big" data-open-stage="postproduction">Open Editing</button>
      <button class="btn secondary" data-help="edit">Help</button>
    </div>
  </div>
</section>

<section class="sen-progress">
  <div class="card">
    <h3>My progress</h3>
    <div class="progress-bar" aria-label="Overall progress">
      <div class="progress-fill" id="overallProgress" style="width:0%"></div>
    </div>
    <p class="muted" id="progressLabel">0% done • Keep going!</p>
  </div>
</section>

<!-- Student – Assignments hub -->
<div class="grid" id="studentAssignments">
  <!-- Stage cards are rendered by JS -->
</div>

<!-- Student – Notifications -->
<div class="card" id="studentNotifications" aria-live="polite">
  <h3>Notifications</h3>
  <ul class="list" id="studentNotices"></ul>
</div>

      <h2 id="studentHeading">Student Dashboard</h2>
      <div class="progress-wrap card">
        <div>
          <strong>Overall Progress</strong>
          <div id="progressBar" class="progress"><div id="progressFill" style="width:0%"></div></div>
          <span id="progressText">0% complete</span>
        </div>
        <div class="stage-actions">
          <button id="exportMyData" class="secondary">Export my data (JSON)</button>
          <button id="certificateBtn" class="secondary">Generate Certificate</button>
        </div>
      </div>
      <div id="stagesContainer" class="stage-grid"></div>
    </section>

    <section id="view-teacher" class="view" aria-labelledby="teacherHeading">
<!-- SEN-Friendly Teacher Dashboard -->
<section class="sen-hero">
  <h3>Teacher dashboard</h3>
  <p class="sen-intro">Quick view of student work. Review with simple steps and clear feedback.</p>
  <div class="sen-toggles">
    <label class="switch"><input type="checkbox" id="tLargeText"><span>Large Text</span></label>
    <label class="switch"><input type="checkbox" id="tCompact"><span>Compact View</span></label>
  </div>
</section>

<section class="teacher-queues grid">
  <div class="card queue">
    <h4>Needs Review</h4>
    <div id="qPending" class="list"></div>
  </div>
  <div class="card queue">
    <h4>In Conversation</h4>
    <div id="qConversation" class="list"></div>
  </div>
  <div class="card queue">
    <h4>Reviewed</h4>
    <div id="qReviewed" class="list"></div>
  </div>
</section>

<!-- Teacher – Submissions dashboard -->
<div class="card">
  <h3>Submissions overview</h3>
  <div class="toolbar">
    <label>Filter:
      <select id="subFilter">
        <option value="all">All</option>
        <option value="pending">Pending review</option>
        <option value="reviewed">Reviewed</option>
        <option value="needs_changes">Needs changes</option>
      </select>
    </label>
    <label>Stage:
      <select id="subStageFilter">
        <option value="all">All stages</option>
        <option value="development">Development</option>
        <option value="preproduction">Pre-Production</option>
        <option value="production">Production</option>
        <option value="postproduction">Post-Production</option>
      </select>
    </label>
  </div>
  <div id="teacherSubmissions" class="list"></div>
</div>

      <h2 id="teacherHeading">Teacher Dashboard</h2>
      <div class="toolbar">
        <input id="searchStudent" type="search" placeholder="Search students…" aria-label="Search students"/>
        <button id="exportCSV" class="secondary">Export Progress (CSV)</button>
      </div>
      <div id="teacherList" class="list"></div>

      <dialog id="studentModal" aria-label="Review student work">
        <form method="dialog">
          <h3 id="studentModalTitle">Review</h3>
          <div id="studentReviewContent"></div>
          <menu><button value="cancel" class="secondary" aria-label="Close worksheet dialog">Close</button></menu>
        </form>
      </dialog>
    </section>

    <section id="view-guardian" class="view" aria-labelledby="guardianHeading">
      <h2 id="guardianHeading">Guardian View (Read-only)</h2>
      <div id="guardianContent"></div>
    </section>

    <section id="view-admin" class="view" aria-labelledby="adminHeading">
      <h2 id="adminHeading">Admin</h2>
      <div class="grid">
        <div class="card">
          <h3>Create / Edit User</h3>
          <form id="userForm">
            <label>Display Name <input id="uName" required /></label>
            <label>Email <input id="uEmail" autocomplete="email" type="email" required /></label>
            <label>Password <input id="uPass" autocomplete="new-password" type="password" required /></label>
            <label>Role
              <select id="uRole" required>
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
                <option value="admin">Admin</option>
                <option value="guardian">Guardian (read-only)</option>
              </select>
            </label>
            <label id="guardianOfWrap" class="hidden">Guardian of (student email)
              <input id="guardianOf" type="email" placeholder="student@example.com" />
            </label>
            <button type="submit">Save User</button>
          </form>
        </div>
        <div class="card"><h3>All Users</h3><div id="userTable" class="list"></div></div>
        <div class="card">
          <h3>Settings</h3>
          <label><input type="checkbox" id="allowPDF" checked/> Allow PDF uploads</label>
          <label><input type="checkbox" id="allowImages" checked/> Allow images (PNG/JPG)</label>
          <label><input type="checkbox" id="allowVideo" checked/> Allow video (MP4)</label>
          
<h4>Stage Resources (URLs + separate uploads)</h4>

<!-- Development -->
<h5>Development</h5>
<label>Video URL <input id="devVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="devWordFile" type="file" accept=".doc,.docx"/></label><div id="devWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="devPdfFile" type="file" accept=".pdf"/></label><div id="devPdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="devPptxFile" type="file" accept=".ppt,.pptx"/></label><div id="devPptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resDev" placeholder="https://..."/></label>

<!-- Pre-Production -->
<h5>Pre-Production</h5>
<label>Video URL <input id="preVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="preWordFile" type="file" accept=".doc,.docx"/></label><div id="preWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="prePdfFile" type="file" accept=".pdf"/></label><div id="prePdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="prePptxFile" type="file" accept=".ppt,.pptx"/></label><div id="prePptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resPre" placeholder="https://..."/></label>

<!-- Production -->
<h5>Production</h5>
<label>Video URL <input id="proVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="proWordFile" type="file" accept=".doc,.docx"/></label><div id="proWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="proPdfFile" type="file" accept=".pdf"/></label><div id="proPdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="proPptxFile" type="file" accept=".ppt,.pptx"/></label><div id="proPptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resPro" placeholder="https://..."/></label>

<!-- Post-Production -->
<h5>Post-Production</h5>
<label>Video URL <input id="postVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="postWordFile" type="file" accept=".doc,.docx"/></label><div id="postWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="postPdfFile" type="file" accept=".pdf"/></label><div id="postPdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="postPptxFile" type="file" accept=".ppt,.pptx"/></label><div id="postPptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resPost" placeholder="https://..."/></label>

<button id="saveSettings" class="secondary">Save Settings</button>
</div>
</div>
</section>

  </main>

  <footer class="app-footer" role="contentinfo"><small>© Oak Hill School Media Lab</small></footer>

  <dialog id="worksheetDialog" aria-label="Worksheet" aria-modal="true" role="dialog">
    <form method="dialog">
      <h3 id="wsTitle">Worksheet</h3>
      <p id="wsDesc" class="muted"></p>
      <div id="wsForm" class="card"></div>
      <menu><button value="cancel" class="secondary" aria-label="Close worksheet dialog">Close</button></menu>
    </form>
  </dialog>

  <!-- Feedback dialog -->
<dialog id="feedbackDialog" aria-label="Teacher Feedback" aria-modal="true" role="dialog">
  <form method="dialog">
    <h3 id="fbTitle">Review Submission</h3>
    <p id="fbMeta" class="muted"></p>

    <div class="grid">
      <div class="card">
        <h4>Rubric</h4>
        <div class="rubric-rows" id="fbRubric"></div>
      </div>

      <div class="card">
        <h4>Comments</h4>
        <label class="block">
          <span class="sr-only">Add text feedback</span>
          <textarea id="fbText" rows="5" placeholder="Short, clear, encouraging feedback…" required></textarea>
        </label>

        <div class="audio-bar">
          <button type="button" id="fbRecordBtn" class="btn" aria-pressed="false">🎙️ Record</button>
          <span id="fbRecordStatus" class="muted">Not recording</span>
          <audio id="fbAudioPreview" controls class="hidden"></audio>
        </div>

        <div class="toolbar">
          <label>Status:
            <select id="fbStatus">
              <option value="reviewed">Reviewed (Good to go)</option>
              <option value="needs_changes">Needs changes</option>
            </select>
          </label>
          <button type="button" id="fbSave" class="btn">Save feedback</button>
        </div>
      </div>

      <div class="card">
        <h4>Conversation</h4>
        <div id="fbThread" class="thread" aria-live="polite"></div>
        <div class="thread-reply">
          <input id="fbReply" placeholder="Reply to this submission…" />
          <button type="button" id="fbSendReply" class="btn">Send</button>
        </div>
      </div>
    </div>

    <menu>
      <button value="cancel" class="secondary" aria-label="Close feedback dialog">Close</button>
    </menu>
  </form>
</dialog>



  <script src="idb.js?v=12"></script>
  <script src="app.js?v=12"></script>
</body>
</html>
