<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oak Hill Media Lab</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css" />
  <meta name="theme-color" content="#ffffff">
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>
  <div id="liveRegion" class="sr-only" aria-live="polite" aria-atomic="true"></div>
  <header class="app-header" role="banner">
    <img src="assets/logo.png" alt="Oak Hill Media Lab logo" class="logo" />
    <h1 id="appTitle">Oak Hill Media Lab</h1>
    <div class="header-actions">
      <button id="themeToggle" aria-pressed="false" title="Toggle high contrast">High Contrast</button>
      <button id="dysToggle" aria-pressed="false" title="Toggle dyslexia-friendly font">Dyslexia Font</button>
      <span id="userChip" class="chip" hidden></span>
      <button id="logoutBtn" class="secondary" hidden>Log out</button>
    </div>
  </header>

  <main id="app" role="main">
    <section id="view-login" class="view active" aria-labelledby="loginHeading">
      <h2 id="loginHeading">Sign in</h2>
      <p class="muted">Use your school account. (Demo mode stores accounts in your browser.)</p>
      <form id="loginForm" class="card" autocomplete="on">
        <label>Email <input id="loginEmail" autocomplete="email" type="email" required autocomplete="email" /></label>
        <label>Password <input id="loginPass" autocomplete="current-password" type="password" required autocomplete="current-password"/></label>
        <button type="submit">Sign in</button>
      </form>
      <details class="help"><summary>First time?</summary><p>Admin demo: <code>admin@oakhill.local</code> / <code>admin123</code></p></details>
    </section>

    <section id="view-student" class="view" aria-labelledby="studentHeading">
      <h2 id="studentHeading">Student Dashboard</h2>
      <div class="progress-wrap card">
        <div>
          <strong>Overall Progress</strong>
          <div id="progressBar" class="progress"><div id="progressFill" style="width:0%"></div></div>
          <span id="progressText">0% complete</span>
        </div>
        <div class="stage-actions">
          <button id="exportMyData" class="secondary">Export my data (JSON)</button>
          <button id="certificateBtn" class="secondary">Generate Certificate</button>
        </div>
      </div>
      <div id="stagesContainer" class="stage-grid"></div>
    </section>

    <section id="view-teacher" class="view" aria-labelledby="teacherHeading">
      <h2 id="teacherHeading">Teacher Dashboard</h2>
      <div class="toolbar">
        <input id="searchStudent" type="search" placeholder="Search students…" aria-label="Search students"/>
        <button id="exportCSV" class="secondary">Export Progress (CSV)</button>
      </div>
      <div id="teacherList" class="list"></div>

      <dialog id="studentModal" aria-label="Review student work">
        <form method="dialog">
          <h3 id="studentModalTitle">Review</h3>
          <div id="studentReviewContent"></div>
          <menu><button value="cancel" class="secondary" aria-label="Close worksheet dialog">Close</button></menu>
        </form>
      </dialog>
    </section>

    <section id="view-guardian" class="view" aria-labelledby="guardianHeading">
      <h2 id="guardianHeading">Guardian View (Read-only)</h2>
      <div id="guardianContent"></div>
    </section>

    <section id="view-admin" class="view" aria-labelledby="adminHeading">
      <h2 id="adminHeading">Admin</h2>
      <div class="grid">
        <div class="card">
          <h3>Create / Edit User</h3>
          <form id="userForm">
            <label>Display Name <input id="uName" required /></label>
            <label>Email <input id="uEmail" autocomplete="email" type="email" required /></label>
            <label>Password <input id="uPass" autocomplete="new-password" type="password" required /></label>
            <label>Role
              <select id="uRole" required>
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
                <option value="admin">Admin</option>
                <option value="guardian">Guardian (read-only)</option>
              </select>
            </label>
            <label id="guardianOfWrap" class="hidden">Guardian of (student email)
              <input id="guardianOf" type="email" placeholder="student@example.com" />
            </label>
            <button type="submit">Save User</button>
          </form>
        </div>
        <div class="card"><h3>All Users</h3><div id="userTable" class="list"></div></div>
        <div class="card">
          <h3>Settings</h3>
          <label><input type="checkbox" id="allowPDF" checked/> Allow PDF uploads</label>
          <label><input type="checkbox" id="allowImages" checked/> Allow images (PNG/JPG)</label>
          <label><input type="checkbox" id="allowVideo" checked/> Allow video (MP4)</label>
          
<h4>Stage Resources (URLs + separate uploads)</h4>

<!-- Development -->
<h5>Development</h5>
<label>Video URL <input id="devVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="devWordFile" type="file" accept=".doc,.docx"/></label><div id="devWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="devPdfFile" type="file" accept=".pdf"/></label><div id="devPdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="devPptxFile" type="file" accept=".ppt,.pptx"/></label><div id="devPptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resDev" placeholder="https://..."/></label>

<!-- Pre-Production -->
<h5>Pre-Production</h5>
<label>Video URL <input id="preVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="preWordFile" type="file" accept=".doc,.docx"/></label><div id="preWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="prePdfFile" type="file" accept=".pdf"/></label><div id="prePdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="prePptxFile" type="file" accept=".ppt,.pptx"/></label><div id="prePptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resPre" placeholder="https://..."/></label>

<!-- Production -->
<h5>Production</h5>
<label>Video URL <input id="proVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="proWordFile" type="file" accept=".doc,.docx"/></label><div id="proWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="proPdfFile" type="file" accept=".pdf"/></label><div id="proPdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="proPptxFile" type="file" accept=".ppt,.pptx"/></label><div id="proPptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resPro" placeholder="https://..."/></label>

<!-- Post-Production -->
<h5>Post-Production</h5>
<label>Video URL <input id="postVideoUrl" placeholder="https://youtube.com/... or direct MP4 URL"/></label>
<label>Word (Upload) <input id="postWordFile" type="file" accept=".doc,.docx"/></label><div id="postWordInfo" class="muted"></div>
<label>PDF (Upload) <input id="postPdfFile" type="file" accept=".pdf"/></label><div id="postPdfInfo" class="muted"></div>
<label>PPTX (Upload) <input id="postPptxFile" type="file" accept=".ppt,.pptx"/></label><div id="postPptxInfo" class="muted"></div>
<label>INTO FILM Source <input id="resPost" placeholder="https://..."/></label>

<button id="saveSettings" class="secondary">Save Settings</button>
</div>
</div>
</section>

  </main>

  <footer class="app-footer" role="contentinfo"><small>© Oak Hill School Media Lab</small></footer>

  <dialog id="worksheetDialog" aria-label="Worksheet" aria-modal="true" role="dialog">
    <form method="dialog">
      <h3 id="wsTitle">Worksheet</h3>
      <p id="wsDesc" class="muted"></p>
      <div id="wsForm" class="card"></div>
      <menu><button value="cancel" class="secondary" aria-label="Close worksheet dialog">Close</button></menu>
    </form>
  </dialog>

  <script src="idb.js?v=12"></script>
  <script src="app.js?v=12"></script>
</body>
</html>
