:root{
  --bg:#ffffff; --fg:#111; --muted:#555; --card:#f6f7f8; --accent:#ffcc00; --brand:#111; --ok:#1e8e3e; --warn:#b00020;
  --radius:16px; --space:16px;
  --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  --font-dys: 'OpenDyslexic', 'Atkinson Hyperlegible', var(--font);
  --shadow: 0 2px 12px rgba(0,0,0,.06);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 var(--font)}
body.dyslexia{font-family:var(--font-dys)}
body.high-contrast{--bg:#ffffff; --fg:#000; --card:#fff; --muted:#000; --accent:#ffd000}
.app-header,.app-footer{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#fff;box-shadow:var(--shadow);position:sticky;top:0;z-index:2}
.app-footer{position:static;margin-top:32px}
.logo{height:48px}
h1,h2,h3{margin:8px 0 12px}
.view{display:none;padding:16px;max-width:1100px;margin:0 auto}
.view.active{display:block}
.card{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);margin:0 0 16px}
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:repeat(2,1fr)}
.stage-grid{display:block}
button, input, select, textarea{font:inherit}
button{background:var(--brand);color:white;border:none;border-radius:12px;padding:10px 14px;cursor:pointer}
button.secondary{background:#eee;color:#111}
button:focus, input:focus, select:focus, textarea:focus{outline:3px solid var(--accent);outline-offset:2px}
input, select, textarea{width:100%;padding:10px;border-radius:12px;border:1px solid #ddd;background:#fff}
label{display:block;margin:8px 0}
.help{margin-top:12px}
.muted{color:var(--muted)}
.progress{height:12px;background:#eee;border-radius:10px;overflow:hidden;margin-top:8px}
.progress>div{height:100%;background:var(--ok)}
.toolbar{display:flex;gap:8px;align-items:center;margin:8px 0}
.list{display:grid;gap:8px}
.card-row{display:flex;justify-content:space-between;align-items:center;background:#fff;border-radius:12px;padding:8px;border:1px solid #eee}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eee;font-size:12px}
.chip{background:#f0f0f0;border-radius:999px;padding:6px 10px}
.header-actions{display:flex;gap:8px;align-items:center}
.hidden{display:none !important}
.stage-card{width:100%;margin-bottom:16px}
.stage-card h4{margin:0 0 8px}
.stage-actions{display:flex;gap:8px;flex-wrap:wrap}
.uploads{font-size:14px;color:#333;margin-top:8px}
.uploads a{display:block;word-break:break-all}
textarea{min-height:96px}
dialog{border:none;border-radius:16px;box-shadow:var(--shadow);width:min(1000px,95vw)}
.file-preview{display:grid;gap:8px}
.file-preview img, .file-preview video{max-width:100%;border-radius:12px}
.file-preview object{width:100%;height:480px;border:1px solid #eee;border-radius:12px}
.rubric{border-collapse:collapse;width:100%;background:#fff;border-radius:12px;overflow:hidden}
.rubric th, .rubric td{border:1px solid #eee;padding:8px;text-align:left}
.badges{display:flex;gap:8px;flex-wrap:wrap}
.badge-tile{background:#fff;border:1px solid #eee;border-radius:12px;padding:8px 12px}

/* SEN-friendly large buttons for resources */
.resource-bar{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.btn{display:inline-flex;align-items:center;gap:8px;background:#111;color:#fff;border:none;border-radius:14px;padding:12px 16px;text-decoration:none;cursor:pointer}
.btn.secondary{background:#eee;color:#111}
.btn .ico{font-size:18px;line-height:1}
.thumb{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid #eee;border-radius:12px;padding:8px 12px}
.thumb .fn{font-weight:600}
.btn-zip{background:#1e8e3e;color:#fff}


/* --- Accessibility utilities --- */
.sr-only{
  position:absolute!important;
  width:1px;height:1px;
  padding:0;margin:-1px;
  overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
}
.skip-link{
  position:absolute;left:-9999px;top:auto;
  width:1px;height:1px;overflow:hidden;
}
.skip-link:focus{
  position:fixed;left:16px;top:16px;width:auto;height:auto;
  background:#000;color:#fff;padding:10px 14px;border-radius:10px;z-index:9999;
}
:focus-visible{
  outline:3px solid var(--accent);
  outline-offset:3px;
}
button, .btn{
  min-height:44px; /* comfortable touch target */
}
input, select, textarea, button{
  font:inherit;
}
/* High contrast mode class (toggle via JS by adding body.high-contrast) */
body.high-contrast{
  --bg:#ffffff; --fg:#000000; --card:#ffffff; --muted:#1a1a1a; --accent:#ffbf00;
}
/* Dyslexia-friendly font class (toggle via body.dyslexia) - font loaded elsewhere */
body.dyslexia{ font-family: var(--font-dys) }
/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce){
  *{ animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}
/* Improve focus for cards and links */
.card:focus-within{ box-shadow: 0 0 0 3px var(--accent); }
a{ color: inherit; }
a:focus-visible{ outline:3px solid var(--accent); outline-offset:2px; }


/* --- WCAG: Interactive states and dialog backdrop --- */
button, .btn { border: 2px solid transparent; }
button:hover, .btn:hover { filter: brightness(0.98); }
button:focus-visible, .btn:focus-visible { outline: 3px solid var(--accent); outline-offset: 2px; }
dialog::backdrop { background: rgba(0,0,0,.45); }
dialog[open] { border: none; border-radius: var(--radius); box-shadow: var(--shadow); }
/* Ensure sufficient text contrast inside accent buttons */
.btn, button.primary { background: var(--accent); color: #000; }
.btn.secondary { background: #eee; color: #111; }


/* Assignments grid */
#studentAssignments { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px; }
.stage-card { background:#fff; border:1px solid #eee; border-radius: var(--radius); padding: 12px; box-shadow: var(--shadow); }
.stage-card h4 { margin: 0 0 8px; }
.stage-actions { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

/* Submissions list */
.list .row { display:flex; gap:12px; align-items:center; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; }
.list .row:last-child{ border-bottom: 0; }
.meta { font-size: 12px; color: var(--muted); }
.status-pill { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid #eee; }
.status-pill.pending{ background:#fff5d6; }
.status-pill.reviewed{ background:#e7ffe7; }
.status-pill.needs_changes{ background:#ffe7e7; }

/* Thread */
.thread { display:flex; flex-direction:column; gap:8px; max-height: 260px; overflow:auto; padding-right:4px; }
.msg { background:#fff; border:1px solid #eee; border-radius:12px; padding:8px 10px; }
.msg .by { font-weight: 600; margin-right: 6px; }
.thread-reply { display:flex; gap:8px; margin-top:8px; }
.thread-reply input { flex: 1; }

/* Rubric */
.rubric-rows { display:grid; gap:8px; }
.rubric-row { display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
.rubric-pick { display:flex; gap:8px; }
.rubric-pick input { margin-right: 4px; }

/* Audio */
.audio-bar { display:flex; gap:10px; align-items:center; }
.hidden { display:none !important; }
.block { display:block; }
.toolbar { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }


/* ---------- SEN-Friendly Layout ---------- */
.sen-hero{ background:#fff; border:1px solid #eee; border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); margin-bottom:12px; }
.sen-intro{ font-size:1rem; margin:0 0 8px; }
.sen-toggles{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
.switch{ display:inline-flex; gap:8px; align-items:center; background:#f3f4f6; padding:8px 12px; border-radius:999px; border:1px solid #e5e7eb; }
.switch input{ width:20px; height:20px; }

.sen-steps{ display:grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:12px; }
.step{ background:#fff; border:1px solid #eee; border-radius:var(--radius); padding:12px; box-shadow:var(--shadow); }
.step-head{ display:flex; align-items:center; gap:8px; }
.step .bubble{ width:28px; height:28px; border-radius:999px; display:inline-grid; place-items:center; background:#111; color:#fff; font-weight:700; }
.step .emoji{ margin-left:auto; font-size:20px; }
.sen-help{ margin:8px 0; }
.checklist{ list-style:none; padding:0; margin:8px 0; display:grid; gap:6px; }
.checklist input{ width:20px; height:20px; }
.step-actions{ display:flex; gap:8px; flex-wrap:wrap; }
.btn.big{ font-size:1rem; padding:14px 18px; border-radius:16px; }

.sen-progress .progress-bar{ width:100%; height:14px; background:#eee; border-radius:999px; overflow:hidden; }
.sen-progress .progress-fill{ height:100%; background:var(--accent); }

/* Teacher queues */
.teacher-queues{ gap:12px; }
.queue .row{ align-items: flex-start; }
.queue .row strong{ font-size:1rem; }
.queue .meta{ margin-top:4px; }

/* Large text toggles */
body.large-text .view, body.large-text .sen-hero, body.large-text .card{ font-size:18px; }
body.large-text .btn{ font-size:18px; }

/* Compact view for teacher */
body.t-compact .list .row{ padding:8px; }


/* Accessibility utilities */
.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
.skip-link:focus{position:fixed;left:16px;top:16px;width:auto;height:auto;background:#000;color:#fff;padding:10px 14px;border-radius:10px;z-index:9999}
:focus-visible{outline:3px solid var(--accent);outline-offset:3px}
button,.btn{min-height:44px}
@media (prefers-reduced-motion: reduce){*{animation:none!important;transition:none!important;scroll-behavior:auto!important}}
dialog::backdrop{background:rgba(0,0,0,.45)}
dialog[open]{border:none;border-radius:var(--radius);box-shadow:var(--shadow)}


/* Distinctive colors per step */
.step[data-step="plan"]{ border-left:6px solid #2563eb; }        /* blue */
.step[data-step="prepare"]{ border-left:6px solid #059669; }     /* green */
.step[data-step="film"]{ border-left:6px solid #d97706; }        /* amber */
.step[data-step="edit"]{ border-left:6px solid #9333ea; }        /* purple */

/* Accordion */
.step-toggle{ all: unset; display:flex; align-items:center; gap:8px; font-weight:700; cursor:pointer; padding:6px 0; }
.step[aria-expanded="true"] .stage-pane{ display:block; }
.step .stage-pane{ display:none; padding-top:8px; }
.step[aria-expanded="true"] .step-toggle::after{ content:"▲"; margin-left:auto; }
.step[aria-expanded="false"] .step-toggle::after{ content:"▼"; margin-left:auto; }

/* Inline upload/history pane */
.stage-pane .upload-row{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
.stage-pane .history{ border-top:1px solid #eee; padding-top:8px; }
.stage-pane .row{ align-items:center; }


/* Voice-to-text toolbar */
.voice-bar{ display:flex; gap:8px; align-items:center; justify-content:flex-end; margin:6px 0 10px; }
.mic-btn[aria-pressed="true"]{ outline:3px solid var(--accent); }
.voice-lang{ padding:6px 8px; border-radius:8px; border:1px solid #ddd; background:#fff; }


/* --- Dialog header with top-close buttons --- */
dialog .dlg-header{
  position: sticky;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  padding: 8px;
  background: #fff;
  border-bottom: 1px solid #eee;
  z-index: 2;
}
dialog .close-btn{
  background: #f5f5f5;
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 6px 10px;
  font-size: 1rem;
  cursor: pointer;
}
dialog .close-btn:hover, dialog .close-btn:focus{
  background: #ffe680;
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}
dialog .btn-x{
  width: 36px;
  height: 36px;
  display: inline-grid;
  place-items: center;
  font-size: 1.2rem;
  line-height: 1;
  padding: 0;
}
/* Hide old bottom-close buttons once header is injected */
.dlg-bottom-close{ display: none !important; }
